<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>XO-Tube Studio</title>
    <style>
        body { background: #333; color: white; font-family: Arial, sans-serif; margin: 0; padding: 10px; }
        .window { background: #c0c0c0; border: 2px solid #fff; border-right-color: #808080; border-bottom-color: #808080; padding: 5px; max-width: 600px; margin: 0 auto; }
        .title-bar { background: #000080; color: white; padding: 3px 5px; font-weight: bold; text-align: left; margin-bottom: 10px; }
        
        /* El contenedor del video */
        #player-container { 
            width: 100%; 
            background: black; 
            position: relative;
            overflow: hidden;
            height: 340px;
        }

        /* Ocultamos los controles originales tapándolos con un div invisible */
        #guard {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10;
            background: transparent;
        }

        iframe { width: 100%; height: 100%; pointer-events: none; }

        .panel-controles { background: #c0c0c0; padding: 10px; border-top: 2px solid #808080; }
        
        button { 
            padding: 5px 10px; margin: 2px; border: 2px solid #fff; 
            border-right-color: #808080; border-bottom-color: #808080;
            background: #c0c0c0; cursor: pointer; font-weight: bold;
        }
        button:active { border: 2px solid #808080; border-right-color: #fff; border-bottom-color: #fff; }
        
        input { width: 70%; padding: 5px; margin-bottom: 10px; }
        .status-bar { background: #c0c0c0; border: 1px inset #fff; padding: 2px; font-size: 12px; color: black; margin-top: 5px; text-align: left; }
    </style>
</head>
<body>

<div class="window">
    <div class="title-bar">XO-Tube Player v2.0</div>
    
    <input type="text" id="url" placeholder="Pega el link aquí...">
    <button onclick="loadVideo()">CARGAR</button>

    <div id="player-container">
        <div id="guard"></div> <div id="player"></div> </div>

    <div class="panel-controles">
        <button onclick="play()">▶ Play</button>
        <button onclick="pause()">⏸ Pausa</button>
        <button style="background:#ffcc00" onclick="setRes('small')">Low (144p)</button>
        <button style="background:#00ccff" onclick="setRes('medium')">Mid (360p)</button>
        <button style="background:#ff5555" onclick="toggleFS()">[ ] Fullscreen</button>
    </div>

    <div class="status-bar" id="status">Estado: Listo</div>
</div>

<script>
    // 1. Cargamos la API de YouTube de forma asíncrona
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    function onYouTubeIframeAPIReady() {
        console.log("API Lista");
    }

    function loadVideo() {
        var val = document.getElementById('url').value;
        var id = val.includes('v=') ? val.split('v=')[1].split('&')[0] : val.split('/').pop();
        
        if (player) { player.destroy(); }

        player = new YT.Player('player', {
            height: '100%',
            width: '100%',
            videoId: id,
            playerVars: {
                'controls': 0,          // DESACTIVA LA INTERFAZ DE YT
                'disablekb': 1,        // Desactiva teclado de YT
                'modestbranding': 1,   // Quita logo
                'rel': 0,              // No recomendados
                'iv_load_policy': 3    // Sin anotaciones
            },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function onPlayerReady(event) {
        document.getElementById('status').innerText = "Estado: Video Cargado";
    }

    function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) document.getElementById('status').innerText = "Estado: Reproduciendo";
        if (event.data == YT.PlayerState.PAUSED) document.getElementById('status').innerText = "Estado: Pausado";
    }

    // Funciones de tus botones propios
    function play() { player.playVideo(); }
    function pause() { player.pauseVideo(); }
    
    function setRes(res) {
        // Intentar forzar calidad
        player.setPlaybackQuality(res);
        document.getElementById('status').innerText = "Calidad: " + res;
        // Reiniciamos para aplicar
        var t = player.getCurrentTime();
        player.loadVideoById(player.getVideoData().video_id, t, res);
    }

    function toggleFS() {
        var p = document.getElementById('player-container');
        if (p.requestFullscreen) p.requestFullscreen();
        else if (p.webkitRequestFullscreen) p.webkitRequestFullscreen();
    }
</script>

</body>
</html>
