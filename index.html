<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>XO Invidious Lite</title>
    <style>
        body { background: #111; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .box { max-width: 500px; margin: 0 auto; background: #222; border: 1px solid #444; padding: 15px; border-radius: 8px; }
        input { width: 80%; padding: 10px; margin-bottom: 10px; background: #000; border: 1px solid #555; color: white; }
        button { background: #f35; color: white; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
        video { width: 100%; margin-top: 20px; border: 1px solid #555; display: none; background: #000; }
        #status { font-size: 12px; color: #aaa; margin-top: 10px; }
    </style>
</head>
<body>

<div class="box">
    <h2>XO Invidious Lite</h2>
    <input type="text" id="ytUrl" placeholder="Pega el link de YouTube">
    <br>
    <button onclick="buscar()">CARGAR VIDEO</button>
    <div id="status">Listo.</div>
    
    <video id="player" controls autoplay></video>
</div>

<script>
    async function buscar() {
        const urlInput = document.getElementById('ytUrl').value;
        const status = document.getElementById('status');
        const video = document.getElementById('player');
        
        const match = urlInput.match(/(?:v=|\/)([a-zA-Z0-9_-]{11})/);
        if (!match) return alert("Link inválido");
        const id = match[1];

        status.innerText = "Buscando archivo MP4 compatible...";
        video.style.display = "none";

        // Usamos una instancia que permite acceso directo a los archivos MP4
        const instancia = "https://inv.tux.rs"; 

        try {
            const res = await fetch(`${instancia}/api/v1/videos/${id}`);
            const data = await res.json();

            // EL SECRETO: Filtramos para ignorar los codecs raros y buscar solo MP4
            // Esto evita el error de "Source not compatible"
            const mp4 = data.formatStreams.find(f => f.container === "mp4" && f.encoding === "h264");

            if (mp4) {
                let finalUrl = mp4.url;
                if (finalUrl.startsWith('/')) finalUrl = instancia + finalUrl;

                video.src = finalUrl;
                video.style.display = "block";
                status.innerText = "Reproduciendo: " + data.title;
            } else {
                status.innerText = "No se encontró un MP4 simple. Prueba otro video.";
            }
        } catch (e) {
            status.innerText = "Error de conexión con el servidor Invidious.";
        }
    }
</script>

</body>
</html>
