<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XO-Tube Final</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; text-align: center; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; background: #1e1e1e; padding: 20px; border-radius: 10px; }
        input { width: 90%; padding: 12px; margin: 10px 0; border-radius: 5px; border: 1px solid #444; background: #2b2b2b; color: white; }
        button { width: 95%; padding: 12px; background: #0088cc; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
        video { width: 100%; margin-top: 20px; border-radius: 5px; display: none; background: black; }
        #estado { margin-top: 15px; color: #aaa; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <h1>XO-Tube 游</h1>
    <input type="text" id="url" placeholder="Pega el link de YouTube">
    <button onclick="reproducir()">REPRODUCIR</button>
    <div id="estado">Listo.</div>
    <video id="vid" controls autoplay></video>
</div>

<script>
    async function reproducir() {
        const urlInput = document.getElementById('url').value;
        const estado = document.getElementById('estado');
        const video = document.getElementById('vid');

        const match = urlInput.match(/(?:v=|\/)([a-zA-Z0-9_-]{11})/);
        if (!match) return alert("Link inv치lido");
        const id = match[1];

        // Usamos una instancia de Invidious que suele ser muy abierta
        const instancia = "https://inv.tux.rs"; 
        
        estado.innerText = "Buscando video...";
        video.style.display = "none";

        try {
            // Buscamos la informaci칩n del video
            const res = await fetch(`${instancia}/api/v1/videos/${id}`);
            const data = await res.json();

            // Buscamos el formato mp4 m치s ligero
            const format = data.formatStreams.find(f => f.container === "mp4" && (f.quality === "360p" || f.quality === "144p")) || data.formatStreams[0];

            if (format) {
                // Invidious requiere que el link sea absoluto
                let videoUrl = format.url;
                if (videoUrl.startsWith('/')) {
                    videoUrl = instancia + videoUrl;
                }

                video.src = videoUrl;
                video.style.display = "block";
                estado.innerText = "Reproduciendo: " + data.title;
            } else {
                estado.innerText = "No se encontr칩 un formato compatible.";
            }
        } catch (e) {
            estado.innerText = "Error: La instancia est치 saturada. Intenta de nuevo.";
            console.error(e);
        }
    }
</script>

</body>
</html>
